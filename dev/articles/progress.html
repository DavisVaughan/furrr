<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Progress notifications with progressr • furrr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Progress notifications with progressr">
<meta property="og:description" content="furrr">
<meta property="og:image" content="https://furrr.futureverse.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">furrr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/carrier.html">Alternative to automatic globals detection</a>
    </li>
    <li>
      <a href="../articles/chunking.html">Chunking input</a>
    </li>
    <li>
      <a href="../articles/gotchas.html">Common gotchas</a>
    </li>
    <li>
      <a href="../articles/progress.html">Progress notifications with progressr</a>
    </li>
    <li>
      <a href="../articles/remote-connections.html">Remote connections</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/furrr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Progress notifications with progressr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/furrr/blob/HEAD/vignettes/articles/progress.Rmd" class="external-link"><code>vignettes/articles/progress.Rmd</code></a></small>
      <div class="hidden name"><code>progress.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Everyone loves progress bars. This is even more true when running long computations in parallel, where you’d really like to have some approximation of when your job is going to finish. furrr currently has its own progress bar through the usage of <code>.progress = TRUE</code>, but in the future this will be deprecated in favor of generic and robust progress updates through the <a href="https://CRAN.R-project.org/package=progressr" class="external-link">progressr</a> package.</p>
<p>If you’ve never heard of progressr, I’d encourage you to read its <a href="https://CRAN.R-project.org/package=progressr/vignettes/progressr-intro.html" class="external-link">introduction vignette</a>. One of the neat things about it is that it isn’t limited to just progress bars. progressr is really a framework for progress <em>updates</em>, which can then be relayed to the user using a progress bar, a beeping noise from their computer, or even through email or slack notifications. It works for sequential, multisession, and cluster futures, which means that it even works with remote connections. It currently doesn’t work with multicore, but that is likely to change.</p>
<p>Before we begin, please be aware that progressr is still a new experimental package. I doubt there will be many breaking changes in it, but new patterns for signaling progress updates will likely emerge after enough people start using it. If you’ve used furrr’s <code>.progress</code> argument, then the solutions presented below might feel a bit clunkier than that. As progressr gets more usage, hopefully a simpler unified way of presenting progress information will emerge that can be used in all of the map-reduce future packages (furrr, future.apply, and doFuture).</p>
<p>How progressr is used varies slightly depending on whether you are a package developer or an interactive user. There are two main functions that are used: <code><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor()</a></code>, which makes an object that can signal progress updates, and <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>, which listens for these progress signals. Generally, <code><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor()</a></code> will be used by a package developer inside of a function that they would like to produce progress updates. When the user calls that function, they won’t get any progress notifications unless they wrap the function call in <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>. Additionally, the user has complete control over how these progress updates are displayed through the use of a <em>progress handler</em>. In progressr, these all start with <code>handler_*()</code> and tell progressr how to display the progress update. This separation of developer API and user API is important, and can be summarized as:</p>
<ul>
<li>Developer:
<ul>
<li>
<code>p &lt;- progressor()</code> for making progress signalers</li>
<li>
<code>p()</code> for signaling a unit of progress</li>
</ul>
</li>
<li>User:
<ul>
<li>
<code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> for listening for progress signals</li>
<li>
<code>handler_*()</code> for displaying those caught progress signals</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="package-developers">Package developers<a class="anchor" aria-label="anchor" href="#package-developers"></a>
</h2>
<p>If you are a package developer using furrr with progressr, the function from your package that calls <code><a href="../reference/future_map.html">future_map()</a></code> should first use <code>p &lt;- progressor()</code> to create a progress object, and then call <code>p()</code> from within <code>.f</code> to signal a progress update after each iteration of the map. For example, the following function iterates over a list, <code>x</code>, calling <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> on each element of the list. At each iteration, we send a progress update. I’ve also introduced a bit of a delay because this otherwise would run extremely fast.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_pkg_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  
  <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span><span class="op">{</span>
    <span class="fu">p</span><span class="op">(</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>From the user’s side, simply calling <code>my_pkg_fun()</code> won’t display anything:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># No notifications</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">my_pkg_fn</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p>However, once the user wraps this in <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>, notifications are displayed. The default is to use <code><a href="https://progressr.futureverse.org/reference/handler_txtprogressbar.html" class="external-link">handler_txtprogressbar()</a></code>, which creates a progress bar with <code><a href="https://rdrr.io/r/utils/txtProgressBar.html" class="external-link">utils::txtProgressBar()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">my_pkg_fn</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |===============================                                     |  30%</span></code></pre></div>
<p>As mentioned before, the <em>user</em> controls how to display progress updates. You can change to a different handler locally by providing it as an argument to <code>with_progress(handlers = )</code>, or you can use <code><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers()</a></code> to set them globally. You can even use multiple handlers. For example, <code>handlers(handler_progress, handler_beepr)</code> can be used to generate a progress bar with the progress package and generate beeps with the beepr package.</p>
</div>
<div class="section level2">
<h2 id="interactive-usage">Interactive usage<a class="anchor" aria-label="anchor" href="#interactive-usage"></a>
</h2>
<p>When writing data analysis scripts that use furrr and progressr, the separation between developer and user APIs is not quite as clear since you’ll need to generate the progress objects with <code><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor()</a></code>, create the function that signals progress by calling <code>p()</code>, and call <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>. It is easiest to show this with an example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span><span class="op">{</span>
    <span class="fu">p</span><span class="op">(</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |=====================                                               |  20%</span></code></pre></div>
<p>Currently, <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> doesn’t return the value of the <code>expr</code>ession that it evaluates, so you have to assign the result to <code>result &lt;-</code>. This is likely to change.</p>
<p>Rather than writing an anonymous function, you might want to wrap the logic of <code>.f</code> up into a real function. The easiest way to do this right now is to have an extra argument for <code>p</code> that you can pass through.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">p</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The important thing here is that <code>p &lt;- progressor()</code> is called from inside <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>. You generally can’t create the progressor object outside of the <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> call. For example, this doesn’t work:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Error in error("length(timestamp) == 0L") : </span>
<span class="co">#&gt;   .validate_internal_state(‘handler(type=update) ... end’): length(timestamp) #&gt; == 0L</span>
<span class="co">#&gt; Error in error("length(timestamp) == 0L") : </span>
<span class="co">#&gt;   .validate_internal_state(‘reporter_args() ... begin’): length(timestamp) == #&gt; 0L</span></code></pre></div>
<div class="section level3">
<h3 id="with-dplyr">With dplyr<a class="anchor" aria-label="anchor" href="#with-dplyr"></a>
</h3>
<p>Because <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> doesn’t return the value of <code>expr</code> right now, current usage of progressr, furrr, and dplyr is far from perfect. The only way to use them together currently is to wrap an entire dplyr pipeline in <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cars</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">carb</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_nest.html" class="external-link">group_nest</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">model_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">disp</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">coef</span>
  
  <span class="fu">p</span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">out</span>
<span class="op">}</span></code></pre></div>
<p>You can create the progressor, <code>p</code>, at the top of the expression, and then call <code><a href="../reference/future_map.html">future_map()</a></code> in <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">cars2</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model_fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |================================================                    |  67%</span></code></pre></div>
<p>Or you can wrap <code>model_fn()</code> in another function that creates <code>p</code> and calls <code><a href="../reference/future_map.html">future_map()</a></code> all at once:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">model_mapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model_fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">cars2</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="fu">model_mapper</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |================================================                    |  67%</span></code></pre></div>
<p>An additional constraint (for now), is that <code><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress()</a></code> will only respect progress updates from the first progressor object that signals one. This means that the first call to <code>model_mapper()</code> will signal updates, but the second won’t.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">cars2</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      mod1 <span class="op">=</span> <span class="fu">model_mapper</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,
      mod2 <span class="op">=</span> <span class="fu">model_mapper</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
    <span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |================================================                    |  67%</span>

<span class="co"># ^ Note, we don't get a second progress bar</span></code></pre></div>
<p>However, if you know that you are going to do something like this then you can use the first approach and create a progressor object that is twice the number of rows in the data frame, and pass it to both calls to <code><a href="../reference/future_map.html">future_map()</a></code>. The state is maintained between <code><a href="../reference/future_map.html">future_map()</a></code> calls so you end up with one long progress bar.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://progressr.futureverse.org/reference/progressor.html" class="external-link">progressor</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span>
  
  <span class="va">cars2</span> <span class="op">&lt;-</span> <span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      mod1 <span class="op">=</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model_fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,
      mod2 <span class="op">=</span> <span class="fu"><a href="../reference/future_map.html">future_map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model_fn</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
    <span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; |===================================                                 |  50%</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>progressr represents an exciting move towards a unified framework for progress notifications in R, but it is still early in its development cycle and needs more usage and feedback to settle on the best API. In the future, the plan is for furrr to become more tightly integrated with progressr so that this is much easier.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Davis Vaughan, Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
